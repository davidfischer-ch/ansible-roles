---

- name: Install building and development tools
  apt: >
    name={{ item }} state=latest
  sudo: yes
  with_items:
    - bpython
    - bpython3
    - build-essential
    - checkinstall
    - python-dev
    - python3-dev

- name: Download pip bootstrap script
  get_url: >
    url=https://bootstrap.pypa.io/get-pip.py dest=/tmp/get-pip.py sha256sum={{ python_get_pip_checksum }}
  sudo: yes

- name: Install pip
  command: >
    python{{ item }} /tmp/get-pip.py {{ python_get_pip_options }} pip{{ python_pip_version }}
  changed_when: "'already up-to-date' not in get_pip_result.stdout|default('') and 'are using pip' not in get_pip_result.stderr|default('')"
  failed_when: "get_pip_result|failed and 'are using pip' not in get_pip_result.stderr|default('')"
  register: get_pip_result
  sudo: yes
  with_items: python_versions

- name: Set pip default version
  file: >
    src={{ python_pip_path }}{{ python_default_version[0] }} dest={{ python_pip_path }} force=yes state=link
  sudo: yes

- name: Install setuptools
  pip: >
    name=setuptools executable=pip{{ item[0] }}
  sudo: yes
  with_items: python_versions

- name: Install virtualenv
  pip: >
    name=virtualenv executable=pip{{ item[0] }} state=latest
  sudo: yes
  with_items: python_versions
