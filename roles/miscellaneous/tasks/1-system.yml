---

- block:
    - name: Install extra PPA repositories
      apt_repository: >
        repo={{ item }} state=present
      register: extra_ppa_result
      with_items: extra_ppa_repos

    - name: Upgrade the Debian packages
      shell: >
        sudo dpkg --configure -a &&
        apt-get -y update &&
        apt-get -y upgrade &&
        apt-get -y dist-upgrade &&
        apt-get -y autoremove &&
        apt-get -y autoclean
      async: "{{ (ansible_connection == 'local')|ternary(omit, 600) }}"
      poll: "{{ (ansible_connection == 'local')|ternary(omit, 5) }}"
      when: upgrade_packages|bool

    - name: Install extra Debian packages
      apt: >
        name={{ item }} state=latest
      with_items: extra_packages

    - name: Set swappiness
      sysctl: >
        name=vm.swappiness value={{ vm_swappiness|int }} sysctl_set=yes state=present
  become: yes
