---

dependencies:
  - role: github
    when: nginx_has_run is undefined

  - role: requirements
    apt_build_requirements:
      - nginx
    apt_requirements:
      # https://developers.google.com/speed/pagespeed/module/build_ngx_pagespeed_from_source
      - build-essential
      - libpcre3
      - libpcre3-dev
      - unzip
      - zlib1g-dev
    when: nginx_has_run is undefined

  - role: supervisor
    when: nginx_has_run is undefined

  - role: ufw
    ufw_rules: "{{ nginx_ufw_rules }}"
    when: nginx_has_run is undefined and nginx_ufw_rules
