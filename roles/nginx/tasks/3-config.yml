---

- block:
    - name: Configure Nginx
      template: >
        src=nginx.conf.j2 dest=/etc/nginx/nginx.conf mode=644
      notify: reload nginx

    - name: Create Nginx directories
      file: >
        name={{ item }} mode=755 state=directory
      with_items:
        - /etc/nginx/sites-enabled/
        - /var/lib/nginx/

    - name: Remove default site
      file: >
        path=/etc/nginx/sites-enabled/default state=absent
      notify: reload nginx

    - name: Configure Nginx service
      template: >
        src=supervisor.conf.j2 dest=/etc/supervisor/conf.d/nginx.conf mode=644
      notify: restart nginx

    - name: Install Nginx service
      supervisorctl: >
        name=nginx state=present
  become: yes
