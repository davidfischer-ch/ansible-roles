---

- block:
    - name: Copy user my.cnf file with root credentials
      template: >
        src=my.cnf.j2 dest=/root/.my.cnf owner=root group=root mode=0600

    - name: Configure MySQL root password
      mysql_user: >
        name=root host={{ item }} password={{ mysql_root_password }} check_implicit_admin=yes state=present
      with_items:
        - "{{ ansible_hostname }}"
        - localhost
        - 127.0.0.1
        - ::1

    - name: Remove anonymous MySQL user
      mysql_user: >
        name='' state=absent

    - name: Remove MySQL test database
      mysql_db: >
        name=test state=absent
  become: yes
