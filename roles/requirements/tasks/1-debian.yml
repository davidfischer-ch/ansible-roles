---

- block:
    - name: Register apt keys
      apt_key: >
        url={{ item }} state=present
      with_items: '{{ key_requirements }}'

    - name: Install PPA repositories
      apt_repository: >
        repo={{ item }} state=present
      register: ppa_requirements_result
      with_items: '{{ ppa_requirements }}'

    - name: Update Debian packages cache
      apt: update_cache=yes
      when: ppa_requirements|length > 0 and ppa_requirements_result|changed

    - name: Install build requirements with apt
      apt: >
        name={{ item }} state=build-dep
      changed_when: apt_build_dep_result.stdout_lines|length > 4
      register: apt_build_dep_result
      with_items: '{{ apt_build_requirements }}'

    - name: Install requirements with apt
      apt: >
        name={{ item }} state=latest
      with_items: '{{ apt_requirements }}'
  become: yes
