---

- name: Enable Canonical partners repository
  apt_repository: >
    repo='{{ item }} http://archive.canonical.com/ubuntu {{ ansible_distribution_release }} partner' state=present
  become: yes
  loop:
    - deb
    - deb-src
  tags: [desktop, config]
  when: ansible_distribution == 'Ubuntu'

- block:
    # Miscellaneous

    - name: Install Nemo apt repository
      apt_repository: >
        repo=ppa:webupd8team/nemo filename=ansible_roles_desktop_nemo state=present update_cache=yes
      when: desktop_package == 'ubuntu-desktop' and 'nemo' in ubuntu_desktop_packages

    # Desktop

    - name: Install Ubuntu packages
      package: >
        name={{ item }} state=present
      loop:
        - '{{ desktop_package }}'
        - ubuntu-minimal
        - ubuntu-restricted-addons
        - ubuntu-restricted-extras
        - libavcodec-extra
        - ubuntu-standard
      when: ansible_distribution == 'Ubuntu'

    - name: Install office packages
      package: >
        name={{ item }} state=present
      loop: '{{ office_packages }}'

    - name: Install Ubuntu desktop packages
      package: >
        name={{ item }} state=present
      loop: '{{ ubuntu_desktop_packages }}'
      when: desktop_package == 'ubuntu-desktop'

    - name: Install system packages
      package: >
        name={{ item }} state=present
      loop: '{{ system_packages }}'

    - name: Update apt-file cache
      command: >
        apt-file update
      when: "ansible_pkg_mgr == 'apt'"

    - name: Remove bumblebee packages
      package: >
        name={{ item }} state=absent
      loop:
        - bumblebee
        - bumblebee-nvidia

    - name: Install files utilities packages
      package: >
        name={{ item }} state=present
      loop: '{{ file_utility_packages }}'

    - name: Install miscellaneous packages
      package: >
        name={{ item }} state=present
      loop: '{{ miscellaneous_packages }}'

    - name: Install virtualization packages
      package: >
        name={{ item }} state=present
      loop: '{{ virtualization_packages }}'

    - name: Install web packages
      package: >
        name={{ item }} state=present
      loop: '{{ web_packages }}'
  become: yes
  tags: [desktop, packages]
