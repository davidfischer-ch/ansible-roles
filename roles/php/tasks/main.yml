# Install and configure PHP
---

- block:
    - name: Install PHP apt repository
      apt_repository: >
        repo={{ php_apt_repository }} update_cache=yes state=present
      when: "ansible_pkg_mgr == 'apt' and php_apt_repository|length > 0"

    - name: Install PHP packages
      package: >
        name={{ item }} state=present
      with_items: '{{ php_packages }}'

    - name: Remove unwanted PHP packages
      package: >
        name={{ item }} state=absent
      with_items: '{{ php_unwanted_packages }}'
  become: yes
  tags: [php, packages]

- name: Configure PHP
  lineinfile: >
    dest=/etc/php{{ php_version }}/apache2/php.ini regexp='^;?{{ item.key }} =' line='{{ item.key }} = {{ item.value }}' state=present
  become: yes
  tags: [php, config]
  with_dict: '{{ php_options }}'
